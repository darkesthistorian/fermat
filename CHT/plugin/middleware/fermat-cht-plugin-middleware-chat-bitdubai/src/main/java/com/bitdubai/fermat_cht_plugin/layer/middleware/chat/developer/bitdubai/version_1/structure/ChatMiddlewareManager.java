package com.bitdubai.fermat_cht_plugin.layer.middleware.chat.developer.bitdubai.version_1.structure;

import com.bitdubai.fermat_api.layer.osa_android.database_system.DatabaseTableFilter;
import com.bitdubai.fermat_cht_api.all_definition.exceptions.CantDeleteChatException;
import com.bitdubai.fermat_cht_api.all_definition.exceptions.CantDeleteContactException;
import com.bitdubai.fermat_cht_api.all_definition.exceptions.CantDeleteMessageException;
import com.bitdubai.fermat_cht_api.all_definition.exceptions.CantGetChatException;
import com.bitdubai.fermat_cht_api.all_definition.exceptions.CantGetContactException;
import com.bitdubai.fermat_cht_api.all_definition.exceptions.CantGetMessageException;
import com.bitdubai.fermat_cht_api.all_definition.exceptions.CantNewEmptyChatException;
import com.bitdubai.fermat_cht_api.all_definition.exceptions.CantNewEmptyContactException;
import com.bitdubai.fermat_cht_api.all_definition.exceptions.CantNewEmptyMessageException;
import com.bitdubai.fermat_cht_api.all_definition.exceptions.CantSaveChatException;
import com.bitdubai.fermat_cht_api.all_definition.exceptions.CantSaveContactException;
import com.bitdubai.fermat_cht_api.all_definition.exceptions.CantSaveMessageException;
import com.bitdubai.fermat_cht_api.all_definition.exceptions.ObjectNotSetException;
import com.bitdubai.fermat_cht_api.all_definition.util.ObjectChecker;
import com.bitdubai.fermat_cht_api.layer.middleware.interfaces.Chat;
import com.bitdubai.fermat_cht_api.layer.middleware.interfaces.ChatManager;
import com.bitdubai.fermat_cht_api.layer.middleware.interfaces.Contact;
import com.bitdubai.fermat_cht_api.layer.middleware.interfaces.Message;
import com.bitdubai.fermat_cht_plugin.layer.middleware.chat.developer.bitdubai.version_1.database.ChatMiddlewareDatabaseDao;
import com.bitdubai.fermat_cht_plugin.layer.middleware.chat.developer.bitdubai.version_1.exceptions.DatabaseOperationException;

import java.util.List;
import java.util.UUID;

/**
 * This class is the implementation of ChatManager.
 * Created by Manuel Perez (darkpriestrelative@gmail.com) on 10/01/16.
 */
public class ChatMiddlewareManager implements ChatManager {

    /**
     * Represents the plugin Database Dao.
     */
    private ChatMiddlewareDatabaseDao chatMiddlewareDatabaseDao;

    /**
     * Represents the contact factory
     */
    private ChatMiddlewareContactFactory chatMiddlewareContactFactory;

    public ChatMiddlewareManager(
            ChatMiddlewareDatabaseDao chatMiddlewareDatabaseDao,
            ChatMiddlewareContactFactory chatMiddlewareContactFactory
    ) {
        this.chatMiddlewareDatabaseDao = chatMiddlewareDatabaseDao;
        this.chatMiddlewareContactFactory = chatMiddlewareContactFactory;
    }

    /**
     * This method returns a full list of chat recorded in database.
     * @return
     * @throws CantGetChatException
     */
    @Override
    public List<Chat> getChats() throws CantGetChatException {
        try{
            return this.chatMiddlewareDatabaseDao.getChatList();
        } catch (DatabaseOperationException exception){
            throw new CantGetChatException(
                    exception,
                    "Getting the chat list from database",
                    "An unexpected error happened in a database operation");
        }
    }

    /**
     * This method returns a chat by UUID
     * @param chatId
     * @return
     * @throws CantGetChatException
     */
    @Override
    public Chat getChatByChatId(UUID chatId) throws CantGetChatException {
        try{
            ObjectChecker.checkArgument(chatId, "The chat Id argument is null");
            return this.chatMiddlewareDatabaseDao.getChatByChatId(chatId);
        } catch (ObjectNotSetException e) {
            throw new CantGetChatException(
                    e,
                    "Getting a chat by UUID",
                    "The chat Id probably is null");
        } catch (DatabaseOperationException e) {
            throw new CantGetChatException(
                    e,
                    "Getting a chat by UUID",
                    "An unexpected error happened in a database operation");
        }
    }

    /**
     * This method returns a new empty instance chat.
     * @return
     * @throws CantNewEmptyChatException
     */
    @Override
    public Chat newEmptyInstanceChat() throws CantNewEmptyChatException {
        return this.chatMiddlewareDatabaseDao.newEmptyInstanceChat();
    }

    /**
     * This method saves a chat, properly formed, in database.
     * @param chat
     * @throws CantSaveChatException
     */
    @Override
    public void saveChat(Chat chat) throws CantSaveChatException {
        try{
            ObjectChecker.checkArgument(chat, "The chat argument is null");
            this.chatMiddlewareDatabaseDao.saveChat(chat);
        } catch (ObjectNotSetException e) {
            throw new CantSaveChatException(
                    e,
                    "Saving a chat in database",
                    "The chat probably is null");
        } catch (DatabaseOperationException e) {
            throw new CantSaveChatException(
                    e,
                    "Saving a chat in database",
                    "An unexpected error happened in a database operation");
        }
    }

    /**
     * This method deletes a chat from database.
     * @param chat
     * @throws CantDeleteChatException
     */
    @Override
    public void deleteChat(Chat chat) throws CantDeleteChatException {
        try{
            ObjectChecker.checkArgument(chat, "The chat argument is null");
            this.chatMiddlewareDatabaseDao.deleteChat(chat);
        } catch (ObjectNotSetException e) {
            throw new CantDeleteChatException(
                    e,
                    "Deleting a chat from database",
                    "The chat probably is null");
        } catch (DatabaseOperationException e) {
            throw new CantDeleteChatException(
                    e,
                    "Deleting a chat from database",
                    "An unexpected error happened in a database operation");
        }
    }

    /**
     * This method returns a full message list.
     * @return
     * @throws CantGetMessageException
     */
    @Override
    public List<Message> getMessages() throws CantGetMessageException {
        try {
            return this.chatMiddlewareDatabaseDao.getMessages();
        } catch (DatabaseOperationException e) {
            throw new CantGetMessageException(
                    e,
                    "Getting the full messages list",
                    "An unexpected error happened in a database operation");
        }
    }

    /**
     * This method returns a message by chat Id.
     * @param chatId
     * @return
     * @throws CantGetMessageException
     */
    @Override
    public Message getMessageByChatId(UUID chatId) throws CantGetMessageException {
        try{
            ObjectChecker.checkArgument(chatId, "The chat id argument is null");
            return this.chatMiddlewareDatabaseDao.getMessageByChatId(chatId);
        } catch (ObjectNotSetException e) {
            throw new CantGetMessageException(
                    e,
                    "Getting a message from database",
                    "The chat id is probably null");
        } catch (DatabaseOperationException e) {
            throw new CantGetMessageException(
                    e,
                    "Getting a message from database",
                    "An unexpected error happened in a database operation");
        }
    }

    /**
     * This method return a message by message id.
     * @param messageId
     * @return
     * @throws CantGetMessageException
     */
    @Override
    public Message getMessageByMessageId(UUID messageId) throws CantGetMessageException {
        try{
            ObjectChecker.checkArgument(messageId, "The message Id is null");
            return this.chatMiddlewareDatabaseDao.getMessageByMessageId(messageId);
        } catch (ObjectNotSetException e) {
            throw new CantGetMessageException(
                    e,
                    "Getting a message from database",
                    "The chat id is probably null");
        } catch (DatabaseOperationException e) {
            throw new CantGetMessageException(
                    e,
                    "Getting a message from database",
                    "An unexpected error happened in a database operation");
        }
    }

    /**
     * This method return a new empty instance message.
     * @return
     * @throws CantNewEmptyMessageException
     */
    @Override
    public Message newEmptyInstanceMessage() throws CantNewEmptyMessageException {
        return this.chatMiddlewareDatabaseDao.newEmptyInstanceMessage();
    }

    /**
     * This method saves a message in database.
     * @param message
     * @throws CantSaveMessageException
     */
    @Override
    public void saveMessage(Message message) throws CantSaveMessageException {
        try{
            ObjectChecker.checkArgument(message, "The message argument is null");
            this.chatMiddlewareDatabaseDao.saveMessage(message);
        } catch (ObjectNotSetException e) {
            throw new CantSaveMessageException(
                    e,
                    "Saving a message in database",
                    "The message is probably null");
        } catch (DatabaseOperationException e) {
            throw new CantSaveMessageException(
                    e,
                    "Saving a message in database",
                    "An unexpected error happened in a database operation");
        }
    }

    /**
     * This method deletes a message from database.
     * @param message
     * @throws CantDeleteMessageException
     */
    @Override
    public void deleteMessage(Message message) throws CantDeleteMessageException {
        try{
            ObjectChecker.checkArgument(message, "The message argument is null");
            this.chatMiddlewareDatabaseDao.deleteMessage(message);
        } catch (ObjectNotSetException e) {
            throw new CantDeleteMessageException(
                    e,
                    "Deleting a message from database",
                    "The message is probably null");
        } catch (DatabaseOperationException e) {
            throw new CantDeleteMessageException(
                    e,
                    "Deleting a message from database",
                    "An unexpected error happened in a database operation");
        }
    }

    @Override
    public List<Contact> getContacts() throws CantGetContactException {
        DatabaseTableFilter filter = null;
        try {
            return this.chatMiddlewareDatabaseDao.getContacts(filter);
        } catch (DatabaseOperationException e) {
            throw new CantGetContactException(
                    e,
                    "Getting the full contac list",
                    "An unexpected error happened in a database operation");
        }
    }

    @Override
    public Contact getContactByContactId(UUID contactId) throws CantGetContactException {
        try{
            ObjectChecker.checkArgument(contactId, "The contact id argument is null");
            return this.chatMiddlewareDatabaseDao.getContactByContactId(contactId);
        } catch (ObjectNotSetException e) {
            throw new CantGetContactException(
                    e,
                    "Getting a message from database",
                    "The contact id is probably null");
        } catch (DatabaseOperationException e) {
            throw new CantGetContactException(
                    e,
                    "Getting a message from database",
                    "An unexpected error happened in a database operation");
        }
    }

    @Override
    public Contact newEmptyInstanceContact() throws CantNewEmptyContactException {
        return this.chatMiddlewareDatabaseDao.newEmptyInstanceContact();
    }

    @Override
    public void saveContact(Contact contact) throws CantSaveContactException {
        try{
            ObjectChecker.checkArgument(contact, "The contact argument is null");
            this.chatMiddlewareDatabaseDao.saveContact(contact);
        } catch (ObjectNotSetException e) {
            throw new CantSaveContactException(
                    e,
                    "Saving a contact in database",
                    "The message is probably null");
        } catch (DatabaseOperationException e) {
            throw new CantSaveContactException(
                    e,
                    "Saving a contact in database",
                    "An unexpected error happened in a database operation");
        }
    }

    @Override
    public void deleteContact(Contact contact) throws CantDeleteContactException {
        try{
            ObjectChecker.checkArgument(contact, "The contact argument is null");
            this.chatMiddlewareDatabaseDao.deleteContact(contact);
        } catch (ObjectNotSetException e) {
            throw new CantDeleteContactException(
                    e,
                    "Deleting a message from database",
                    "The message is probably null");
        } catch (DatabaseOperationException e) {
            throw new CantDeleteContactException(
                    e,
                    "Deleting a message from database",
                    "An unexpected error happened in a database operation");
        }
    }

    /**
     * This method returns the active registered actors to contact list.
     * @return
     * @throws CantGetContactException
     */
    @Override
    public List<Contact> discoverActorsRegistered() throws CantGetContactException {
        return this.chatMiddlewareContactFactory.discoverDeviceActors();
    }
}
